jQuery(function(e){var t="http://cushy.com/",i=e(document),n=i.find("input#pluginPath").val(),a=1,s=!1,d=[];window.location.href;e(document).find(".cushy-preview").remove(),i.addClass("cushy-media-modal media-modal"),i.find("a#add-cushy-button").html('<img src="'+n+'/assets/cushy-logo.png" alt="add cushy" style="width:18px; margin-top: -4px;" />Add cushy'),e.fn.calculateAspectRatioFit=function(e,t,i,n){var a=Math.min(i/e,n/t);return{width:e*a,height:t*a}};firebase.initializeApp({apiKey:"AIzaSyANllP6j2E8zZYw6IwSkJaNNulxINwgd3M",authDomain:"cushyapp-c3f41.firebaseapp.com",databaseURL:"https://cushyapp-c3f41.firebaseio.com",projectId:"cushyapp-c3f41",storageBucket:"cushyapp-c3f41.appspot.com",messagingSenderId:"265282831478"});var c=new firebase.auth.GoogleAuthProvider;c.addScope("https://www.googleapis.com/auth/contacts.readonly"),i.on("click","#settingsSaveBtn",function(){firebase.auth().signInWithPopup(c).then(function(t){t.credential.accessToken;var i=t.user,n=i.email,a=i.displayName;i.photoURL,i.refreshToken,i.userToken;e.ajax({type:"POST",url:"https://user.cushy.com/v1/data/blog_plugin_login",headers:{cushy_api_key:"3bcd1fb0eaeabe09e96ae043e3f209a7",auth_secret:"11fc2ab1fe734795d0d2f25dfd93bc81"},data:{email_id:n},cache:"false",dataType:"json",success:function(t){void 0!==t.result&&"SUCCESS"==t.result?(user_id=t.user_id,user_display_name=a,blog_url=window.location.href,e("input#user_id").val(user_id),e("input#user_display_name").val(user_display_name),e("input#blog_url").val(blog_url),e("form#authenticateForm").submit()):console.log(t.message)}})})}),e.fn.has_scrollbar=function(){var e=this.get(0);if(e.scrollHeight>e.clientHeight)return!0},e.fn.fetchCushyList=function(t,n){setTimeout(function(){if(0==s){s=!0;var a=e.trim(e(document).find("#user_id").val()),d=e.trim(e(document).find("#media-search-input").val());e("#TB_window").addClass("cushyTBWindow"),""!==a?e.ajax({method:"GET",url:"https://user.cushy.com/v1/data/get_filtered_cushy_by_user",headers:{cushy_api_key:"3bcd1fb0eaeabe09e96ae043e3f209a7",auth_secret:"11fc2ab1fe734795d0d2f25dfd93bc81"},data:{user_id:a,count:20,page:t,key:d},beforeSend:function(){d.length>0||void 0!==n?e.fn.searchFieldActions(!0):e(".pre-loader").show()},dataType:"json",success:function(t){if(e.fn.searchFieldActions(!1),s=!1,e(".pre-loader").hide(),e("button#loadMoreBtn").text("Load more"),"SUCCESS"==t.result&&void 0!==t.records&&t.records.length>0){var a="";(d.length>0||void 0!==n)&&e("#TB_window").find(".render-cushy-list").find("li").not("li.pre-loader-content").remove();var c=thumbUrl="";if(e.each(t.records,function(e,t){c=void 0!==t.media_url_medium?t.media_url_medium:"",thumbUrl=void 0!==t.media_url_small?t.media_url_small:"";var n=new Date(1e3*t.cushy_captured_time);dateString=n.toGMTString(),a='<li tabindex="0" role="checkbox" aria-label="'+e+'" data-id="'+t.cushy_id+'" class="attachment save-ready select-item is-def-ite"><div class="attachment-preview js--select-attachment type-image subtype-png landscape"><div class="thumbnail cushy-lazy-bg" rel="'+t.cushy_id+'"><div class="centered"><img class="thumb-img" src="'+thumbUrl+'" draggable="false" alt="N/A"></div></div></div><button type="button" class="button-link check" tabindex="0"><span class="media-modal-icon"></span><span class="screen-reader-text">Deselect</span></button><input type="hidden" id="cushy_id'+t.cushy_id+'" name="cushy_id[]" value="'+t.cushy_id+'"><input type="hidden" id="cushy_view_url'+t.cushy_id+'" name="cushy_view_url[]" value="'+t.view_url+'"><input type="hidden" id="cushy_media'+t.cushy_id+'" name="cushy_media[]" value="'+c+'"><input type="hidden" id="cushy_desc'+t.cushy_id+'" name="cushy_desc[]" value="'+t.description+'"><input type="hidden" id="cushy_loc'+t.cushy_id+'" name="cushy_loc[]" value="'+t.location+'"><input type="hidden" id="cushy_date'+t.cushy_id+'" name="cushy_date[]" value="'+dateString+'"><input type="hidden" id="cushy_tags'+t.cushy_id+'" name="cushy_tags[]" value="'+t.tags_csv+'"><input type="hidden" id="cushy_img_data'+t.cushy_id+'" name="cushy_img_data[]" value="'+t.media_original_width+"x"+t.media_original_height+'">',i.find("#TB_window").find(".render-cushy-list").append(a)}),i.find("#TB_window").find(".render-cushy-list").find("img.thumb-img").load(function(){this.style.opacity=1}),void 0!==t.next&&t.next>0&&t.records.length>=20){e("#TB_window").find(".render-cushy-list").append('<li class="btn-load-wrap"><button type="button" id="loadMoreBtn" class="btn btn-md btn-core-btn">Load more</button></li>')}}else void 0!==t.message&&""!==t.message?e("#TB_window").find(".render-cushy-list").html('<li class="error-holder">'+t.message+"</li>"):void 0!=t.data.records&&0==t.data.records.length&&e("#TB_window").find(".render-cushy-list").html('<li class="error-holder">No matching cushys</li>'),i.find(".clear-selection").trigger("click")},error:function(){}}):(e(".pre-loader").hide(),e("#TB_window").find(".render-cushy-list").html('<li class="error-holder">Cushy credentials are missing</li>'),console.log("Cushy credentials are missing"))}},500)},e("#add-cushy-button").on("click",function(){s=!1,a=1,d=[],"",e.fn.fetchCushyList(a)});var o=!1;i.on("keyup click",".cushy-search-input",function(t){var i=e.trim(e(this).val());clearTimeout(e.data(this,"timer")),a=1,"keyup"==t.type&&(i.length>2||0===i.length)&&(o=!0,e(this).data("timer",setTimeout(function(){e.fn.fetchCushyList(a,o)},200))),"click"==t.type&&i.length>0&&o&&(o=!1,e(this).data("timer",setTimeout(function(){e.fn.fetchCushyList(a,o)},200)))}),i.on("click",".search-close-icon",function(t){i.find(".cushy-search-input").val(""),a=1,e.fn.fetchCushyList(a,!1)}),e.fn.searchFieldActions=function(e){e?i.find(".search-fld-btn").addClass("search-load-icon").removeClass("search-close-icon"):i.find(".cushy-search-input").val().length>0?i.find(".search-fld-btn").addClass("search-close-icon").removeClass("search-load-icon"):i.find(".search-fld-btn").removeClass("search-load-icon search-close-icon")},i.on("click","button#loadMoreBtn",function(t){e(this).attr("disabled",!0).text("Loading..."),a++,e(".btn-load-wrap").fadeOut(),e.fn.fetchCushyList(a)});i.on("click","li.select-item",function(t){!(!t.ctrlKey&&!t.metaKey);var n=e(this).attr("data-id"),a=e.inArray(n,d);a>=0?d.splice(a,1):5===d.length?alert("You can select upto 5 Cushy's"):d.push(n),i.find("li.select-item").removeClass("selected details"),d.length>0&&e.each(d,function(t,i){e("[data-id='"+i+"']").addClass("selected")}),e(this).addClass("details");var s=d.length;if(s>0){var c=e(this).find(".thumbnail").attr("src"),o=(c=e("#cushy_media"+n).val(),e("#cushy_desc"+n).val()),r=e("#cushy_loc"+n).val(),l=e("#cushy_date"+n).val();i.find(".cushy-overview").show(),i.find(".attachment-info .thumbnail-image img").attr("src",c),e("input.cushy-media").val(c),e("textarea.cushy-caption").val(o.replace(/\\/g,"")),e("input.cushy-loc").val(r.replace(/\\/g,"")),e("input.cushy-date").val(l);var u=e("#cushy_tags"+n).val();""!==u?e(".tags-block").css("display","block").find(".cushy-tags").html(u):e(".tags-block").css("display","none").find(".cushy-tags").html(""),i.find(".return-btn").is(":visible")||e(".media-selection").show(),e(".media-selection").find(".count").text(s+" selected"),i.find(".media-button-insert").attr("disabled",!1)}else e(".media-selection").hide(),i.find(".media-button-insert").attr("disabled",!0)}),i.on("click",".edit-selection",function(){i.find(".select-item").not(".selected").hide(),i.find(".media-selection, button#loadMoreBtn").hide(),i.find(".return-btn").show()}),i.on("click",".clear-selection",function(){d=[],i.find(".select-item").removeClass("selected details"),i.find(".media-button-insert").attr("disabled",!0),e(".media-selection, .cushy-overview").hide()}),i.on("click",".return-btn",function(){e(this).hide(),i.find(".select-item, .media-selection, button#loadMoreBtn").show()}),e(document).on("click",".thumbnail",function(){e("body").removeClass("active-cushy"),e(this).addClass("active-cushy")}),e.fn.removeIframeMargin=function(){setTimeout(function(){e("#content_ifr").contents().find("head").append(e("<link/>",{rel:"stylesheet",href:n+"/css/cushy-override.css",type:"text/css"}))},1)};e(document).on("click",".media-button-insert",function(){if(!(d.length>0))return e(this).attr("disabled",!0),!1;e(this).attr("disabled",!1),e.each(d,function(t,i){var n=e("#cushy_img_data"+i).val();'<div class="cushy-card" style="display: none">[cushyview caption="'+e("#cushy_desc"+i).val()+'" id="'+i+'" img_data="'+n+'"]\n</div>';var a=n.split("x");void 0!==a&&void 0!==a[0]&&a[0]>a[1]&&480;var s='[cushy_card caption="'+e("#cushy_desc"+i).val()+'" id="'+i+'" img_data="'+n+'"]';wp.media.editor.insert(s)}),d=[],e.fn.removeIframeMargin()}),e(document).on("click",".media-modal-close",function(){a=1,d=[],"",i.find(".select-item").removeClass("selected details"),i.find("#TB_window").fadeOut(),i.find("#TB_overlay").css({background:"transparent",opacity:1})}),"undefined"!=typeof tinyMCE&&(null!=tinyMCE.activeEditor&&0==tinyMCE.activeEditor.isHidden()||(e.fn.tinyMcePluginParser=function(){tinymce.PluginManager.add("cushy_card",function(i,a){var s="cushy_card";function d(e,t){return(t=new RegExp(t+'="([^"]+)"',"g").exec(e))?window.decodeURIComponent(t[1]):""}function c(i){return i.replace(/\[cushy_card([^\]]*)\]/g,function(i,a,c){return function(i,a,s){var c=d(a,"id"),o=d(a,"img_data").split("x"),r=0,l=0,u=d(a,"caption"),h=u.length,m=20;if(h>60&&(m=Math.round(h/60*m)),void 0!==o&&void 0!==o[0]){imgWidth=o[0],imgHeight=o[1];var f=e(window).width()<1440?75*e(document).find(".mce-edit-area").innerWidth()/100:e(document).find(".mce-edit-area").innerWidth();return l=(l=imgHeight/imgWidth*f)+m+140,l=Math.round(l),f>imgWidth?(r=imgWidth,l=imgHeight):r=f,a=window.encodeURIComponent(a),content=window.encodeURIComponent(s),e(document).find(".mce-preview-object").css("display","none"),e(document).find(".aboutCushy").css("display","none"),'<iframe scrolling="no" seamless="seamless" src="'+t+"/o/blog/"+c+'" width="'+r+'" height="'+l+'" class="mceItem '+i+'" data-sh-attr="'+a+'" data-sh-content="'+s+'" frameborder="0" style="border: solid 1px #e1e1e1;width: '+r+"px; height: "+l+"px; max-width: "+r+"px; max-height: "+l+"px;overflow: hidden!important; background: #D8D8D8 url("+n+'/assets/loader.png) no-repeat center center;"></iframe>'}}("wp-"+s,a,c)})}i.on("BeforeSetcontent",function(e){e.content=c(e.content)}),i.on("GetContent",function(e){e.content=e.content.replace(/(<iframe.*?>.*?<\/iframe>)/g,function(e,t){var i=d(t,"data-sh-attr");return d(t,"data-sh-content"),i?"<p>["+s+i+"]</p>":e})}),e.fn.removeIframeMargin()})},e.fn.tinyMcePluginParser()))});